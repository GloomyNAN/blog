<!DOCTYPE html>
<html lang="zh-CN">
  <head><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="description" content="《MySQL必知必会》笔记"/><link rel="alternate" href="/atom.xml" title="Yikes">
<link rel="canonical" href="http://blog.gloomynan.com/2020/06/29/Databases/《MySQL必知必会》笔记/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=" />

<script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
  window.config = {"leancloud":"","toc":"","fancybox":"","pjax":"","latex":""};
</script>

    <title>《MySQL必知必会》笔记 - Yikes</title>
  <meta name="generator" content="Hexo 4.2.1"></head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">Yikes</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list"></ul>
</nav>
<div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">Yikes</a>
</div>

<nav class="site-navbar"></nav>
</header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content"><article class="post">
    <header class="post-header">
      <h1 class="post-title">《MySQL必知必会》笔记
        </h1>

      <div class="post-meta">
        <span class="post-time">
          2020-06-29
        </span></div>
    </header>

    <div class="post-content"><h2 id="第三章-使用MySQL"><a href="#第三章-使用MySQL" class="headerlink" title="第三章 使用MySQL"></a>第三章 使用MySQL</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> &lt;table_name&gt;;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> &lt;table_name&gt;;</span><br><span class="line"><span class="keyword">describe</span> &lt;table_name&gt;; <span class="comment">-- 同 show columns</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">status</span>;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> &lt;<span class="keyword">database</span>&gt;;<span class="comment">-- 建库语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> &lt;table_name&gt;;<span class="comment">-- 检表语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">grants</span>;<span class="comment">-- 权限</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">errors</span>; </span><br><span class="line"><span class="keyword">show</span> <span class="keyword">warnings</span>;</span><br></pre></td></tr></table></figure>
<p>tips: <code>\g</code>结尾或<code>;</code></p>
<h2 id="第九章-用正则表达式进行搜索"><a href="#第九章-用正则表达式进行搜索" class="headerlink" title="第九章 用正则表达式进行搜索"></a>第九章 用正则表达式进行搜索</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">regexp <span class="comment">-- 正则表达式</span></span><br><span class="line">regexp '1|2'</span><br><span class="line">regexp '[123]'</span><br><span class="line">regexp '[1|2|3]'</span><br><span class="line">regexp '[0-9|a-z|A-Z]'</span><br><span class="line"><span class="comment">-- .匹配任意字符串</span></span><br><span class="line"><span class="comment">-- \\ 前导查找点</span></span><br><span class="line">regexp '[\\.]'</span><br><span class="line"><span class="comment">-- 测试正则</span></span><br><span class="line"><span class="keyword">select</span> &lt;table_name&gt; regexp <span class="string">'[0-9]'</span>;</span><br></pre></td></tr></table></figure>








<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> prod_name</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> prod_name REGEXP <span class="string">'\\([0-9] sticks?\\)'</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> prod_name;</span><br></pre></td></tr></table></figure>





<h2 id="第十一章-使用函数处理"><a href="#第十一章-使用函数处理" class="headerlink" title="第十一章 使用函数处理"></a>第十一章 使用函数处理</h2>



<h2 id="第十二章-聚合函数"><a href="#第十二章-聚合函数" class="headerlink" title="第十二章 聚合函数"></a>第十二章 聚合函数</h2>



<h2 id="第十五章-联结表"><a href="#第十五章-联结表" class="headerlink" title="第十五章 联结表"></a>第十五章 联结表</h2><p>inner join<br>内连接，等值链接，默认方式</p>
<p>left /right out join 外链接</p>
<h2 id="第十七章组合查询"><a href="#第十七章组合查询" class="headerlink" title="第十七章组合查询"></a>第十七章组合查询</h2><p>多个where和单独操作时间相同，多个where条件语句相当于字句都是一个select语句一个组合查询；</p>
<p><strong>union 过滤重复的行，union all不过滤重复</strong></p>
<p>union 和where一样，只能在最后一条select后有一个order by字句,不能存在分别排序；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- union</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> prod_price &lt;= <span class="number">5</span></span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> vend_id, prod_id, prod_price</span><br><span class="line"><span class="keyword">FROM</span> products</span><br><span class="line"><span class="keyword">WHERE</span> vend_id <span class="keyword">IN</span> (<span class="number">1001</span>,<span class="number">1002</span>);</span><br></pre></td></tr></table></figure>

<h2 id="第十八章-理解全文本搜索"><a href="#第十八章-理解全文本搜索" class="headerlink" title="第十八章 理解全文本搜索"></a>第十八章 理解全文本搜索</h2><p>mysiam支持全文搜索，innodb不支持；</p>
<blockquote>
<p>为了进行全文本搜索，必须索引被搜索的列，而且要随着数据的改变不断地重新索引。在对表列进行适当设计后，MySQL会自动进行所有的索引和重新索引。<br>在索引之后，SELECT 可与Match() 和Against() 一起使用以实际执行搜索</p>
</blockquote>
<p><strong>启用全文本搜索支持</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> productnotes</span><br><span class="line">(</span><br><span class="line">  note_id    <span class="built_in">int</span>           <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  prod_id    <span class="built_in">char</span>(<span class="number">10</span>)      <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  note_date datetime       <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  note_text  <span class="built_in">text</span>          <span class="literal">NULL</span> ,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span>(note_id),</span><br><span class="line">  FULLTEXT(note_text) <span class="comment">-- 搜索字段</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=MyISAM;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>定以后MySQL自动维护该索引</p>
</blockquote>
<blockquote>
<p>不要在导入数据时使用FULLTEXT 更新索引要花时间，虽然不是很多，但毕竟要花时间。如果正在导入数据到一个新表，此时不应该启用FULLTEXT 索引。应该首先导入所有数据，然后再修改表，定义FULLTEXT 。这样有助于更快地导入数据（而且使索引数据的总时间小于在导入每行时分别进行索引所需的总时间）。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在索引之后，使用两个函数Match() 和Against() 执行全文本搜索，其中Match() 指定被搜索的列，Against() 指定要使用的搜索表达式。</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> note_text</span><br><span class="line"><span class="keyword">FROM</span> productnotes</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">'rabbit'</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用完整的Match() 说明 传递给Match() 的值必须与FULLTEXT() 定义中的相同。如果指定多个列，则必须列出它们（而且次序正确）。<br>搜索不区分大小写 除非使用BINARY 方式（本章中没有介绍），否则全文本搜索不区分大小写。</p>
</blockquote>
<p>搜索结果根据优先级排序</p>
<h4 id="布尔文本搜索"><a href="#布尔文本搜索" class="headerlink" title="布尔文本搜索"></a>布尔文本搜索</h4><blockquote>
<p>即使没有FULLTEXT 索引也可以使用 布尔方式不同于迄今为止使用的全文本搜索语法的地方在于，即使没有定义FULLTEXT 索引，也可以使用它。但这是一种非常缓慢的操作（其性能将随着数据量的增加而降低）。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> note_text</span><br><span class="line"><span class="keyword">FROM</span> productnotes</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">'heavy'</span> <span class="keyword">IN</span> <span class="built_in">BOOLEAN</span> <span class="keyword">MODE</span>);</span><br></pre></td></tr></table></figure>






<h2 id="第十九章-插入数据"><a href="#第十九章-插入数据" class="headerlink" title="第十九章 插入数据"></a>第十九章 插入数据</h2><blockquote>
<p>总是使用列的列表 一般不要使用没有明确给出列的列表的INSERT 语句。使用列的列表能使SQL代码继续发挥作用，即使表结构发生了变化。</p>
</blockquote>
<blockquote>
<p>仔细地给出值 不管使用哪种INSERT 语法，都必须给出VALUES 的正确数目。如果不提供列名，则必须给每个表列提供一个值。如果提供列名，则必须对每个列出的列给出一个值。如果不这样，将产生一条错误消息，相应的行插入不成功。<br><strong>省略列需要可以为空或者有默认值</strong></p>
</blockquote>
<h4 id="提高性能"><a href="#提高性能" class="headerlink" title="提高性能"></a>提高性能</h4><p>提高整体性能 数据库经常被多个客户访问，对处理什么请求以及用什么次序处理进行管理是MySQL的任务。INSERT 操作可能很耗时（特别是有很多索引需要更新时），而且它可能降低等待处理的SELECT 语句的性能。<br>如果数据检索是最重要的（通常是这样），则你可以通过在<code>INSERT</code>和<code>INTO</code>之间添加关键字<code>LOW_PRIORITY</code>，指示MySQL降低INSERT 语句的优先级，如下所示：<br> <code>INSERT LOW_PRIORITY INTO</code>;<br> 也适用于update和delete操作；</p>
<p><strong>insert多条比单条处理速度快</strong> </p>
<h4 id="导入查询结果"><a href="#导入查询结果" class="headerlink" title="导入查询结果"></a>导入查询结果</h4><p>INSERT SELECT 中的列名 为简单起见，这个例子在INSERT 和SELECT 语句中使用了相同的列名。但是，不一定要求列名匹配。事实上，MySQL甚至不关心SELECT 返回的列名。它使用的是列的位置，因此SELECT 中的第一列（不管其列名）将用来填充表列中指定的第一个列，第二列将用来填充表列中指定的第二个列，如此等等。这对于从使用不同列名的表中导入数据是非常有用的。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customers(cust_id,</span><br><span class="line">    cust_contact,</span><br><span class="line">    cust_email,</span><br><span class="line">    cust_name,</span><br><span class="line">    cust_address,</span><br><span class="line">    cust_city,</span><br><span class="line">    cust_state,</span><br><span class="line">    cust_zip,</span><br><span class="line">    cust_country)</span><br><span class="line"><span class="keyword">SELECT</span> cust_id,</span><br><span class="line">    cust_contact,</span><br><span class="line">    cust_email,</span><br><span class="line">    cust_name,</span><br><span class="line">    cust_address,</span><br><span class="line">    cust_city,</span><br><span class="line">    cust_state,</span><br><span class="line">    cust_zip,</span><br><span class="line">    cust_country</span><br><span class="line"><span class="keyword">FROM</span> custnew;</span><br></pre></td></tr></table></figure>

<h3 id="第二十章-更新和删除数据"><a href="#第二十章-更新和删除数据" class="headerlink" title="第二十章 更新和删除数据"></a>第二十章 更新和删除数据</h3><p><strong>更新和删除不要省略where条件，可先select 数据验证</strong></p>
<blockquote>
<p>IGNORE 关键字 如果用UPDATE 语句更新多行，并且在更新这些行中的一行或多行时出一个现错误，则整个UPDATE 操作被取消（错误发生前更新的所有行被恢复到它们原来的值）。为即使是发生错误，也继续进行更新，可使用IGNORE 关键字:  <code>UPDATE IGNORE customers ..</code>,清除值可设置为<code>NULL</code>;</p>
</blockquote>
<h4 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h4><p>更快的删除 如果想从表中删除所有行，不要使用DELETE 。可使用TRUNCATE TABLE 语句，它完成相同的工作，但速度更快（TRUNCATE 实际是删除原来的表并重新创建一个表，而不是逐行删除表中的数据）。</p>
<h3 id="第二十一章-创建和操纵表"><a href="#第二十一章-创建和操纵表" class="headerlink" title="第二十一章  创建和操纵表"></a>第二十一章  创建和操纵表</h3><h4 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h4><ul>
<li>CREATE TABLE</li>
<li>AUTO_INCREMENT</li>
<li>ENGING=InnoDB</li>
<li>PRIMARY KEY</li>
<li>IF NOT EXISTS</li>
<li>NULL NOT NULL</li>
<li>COMMIT</li>
<li>DEFAULT</li>
</ul>
<h4 id="常见数据库引擎"><a href="#常见数据库引擎" class="headerlink" title="常见数据库引擎"></a>常见数据库引擎</h4><ul>
<li>InnoDB 是一个可靠的事务处理引擎（参见第26章），它不支持全文本搜索；</li>
<li>MEMORY 在功能等同于MyISAM ，但由于数据存储在内存（不是磁盘）中，速度很快（特别适合于临时表）；</li>
<li>MyISAM 是一个性能极高的引擎，它支持全文本搜索（参见第18章），但不支持事务处理。</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>外键不能跨引擎 混用引擎类型有一个大缺陷。外键（用于强制实施引用完整性，如第1章所述）不能跨引擎，即使用一个引擎的表不能引用具有使用不同引擎的表的外键。</p>
<h3 id="第二十二章-使用视图"><a href="#第二十二章-使用视图" class="headerlink" title="第二十二章  使用视图"></a>第二十二章  使用视图</h3><h4 id="使用的理由："><a href="#使用的理由：" class="headerlink" title="使用的理由："></a>使用的理由：</h4><ul>
<li>重用SQL语句。</li>
<li>简化负责的SQL操作</li>
<li>使用表的组成部分而不是这个表</li>
<li>保护数据</li>
<li>格式化数据</li>
</ul>
<p>复杂的视图或嵌套的视图会使性能下降的很厉害，应测试后使用</p>
<h4 id="规则和限制"><a href="#规则和限制" class="headerlink" title="规则和限制"></a>规则和限制</h4><ul>
<li>命名唯一</li>
<li>数量无限制</li>
<li>可以嵌套</li>
<li>order by可以在视图中，如果select中也有order by将覆盖视图中的</li>
<li>不能索引，也不能有关联的触发器或默认值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span></span><br><span class="line"><span class="comment">-- 查看创建语句</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> viewname;</span><br><span class="line">deop view viewname;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 更新可以先drop再create,也可以create or replace view.</span></span><br></pre></td></tr></table></figure>

<h3 id="第二十三章-使用存储过程"><a href="#第二十三章-使用存储过程" class="headerlink" title="第二十三章  使用存储过程"></a>第二十三章  使用存储过程</h3><h4 id="理由"><a href="#理由" class="headerlink" title="理由"></a>理由</h4><ul>
<li>封装SQL，简化操作</li>
<li>保证数据完整性，使用代码相同</li>
<li>简化数据库变动管理，直接对接存储过程</li>
<li>提高性能，存储过程比单条SQL执行快</li>
<li>单个请求的SQL元素和特性，存储过程更灵活</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- call调用 mysql所有变量以@开头</span></span><br><span class="line"><span class="keyword">CALL</span> productpricing(@pricelow,</span><br><span class="line">                    @pricehigh,</span><br><span class="line">                    @priceaverage);</span><br><span class="line">                    </span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建存储过程,存储过程代码位于BEGIN 和END之间</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">SELECT</span> <span class="keyword">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line">   <span class="keyword">FROM</span> products;</span><br><span class="line"><span class="keyword">END</span>;      </span><br><span class="line"></span><br><span class="line"><span class="comment">-- mysql 命令行客户机的分隔符 如果你使用的是mysql 命令行实用程序，应该仔细阅读此说明。</span></span><br><span class="line"><span class="comment">-- 默认的MySQL语句分隔符为;（正如你已经在迄今为止所使用的MySQL语句中所看到的那样）。mysql 命令行实用程序也使用;作为语句分隔符。如果命令行实用程序要解释存储过程自身内的;字符，则它们最终不会成为存储过程的成分，这会使存储过程中的SQL出现句法错误。</span></span><br><span class="line"><span class="comment">-- 解决办法是临时改变命令使用程序的语句分隔符</span></span><br><span class="line"></span><br><span class="line"> DELIMITER //</span><br><span class="line"></span><br><span class="line">  <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> productpricing()</span><br><span class="line">  <span class="keyword">BEGIN</span></span><br><span class="line">     <span class="keyword">SELECT</span> <span class="keyword">Avg</span>(prod_price) <span class="keyword">AS</span> priceaverage</span><br><span class="line">     <span class="keyword">FROM</span> products;</span><br><span class="line">  <span class="keyword">END</span> //</span><br><span class="line"></span><br><span class="line">  DELIMITER ;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">-- 删除,如果不存在会产生错误，可加IF EXISTS</span></span><br><span class="line">  <span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> <span class="keyword">name</span>;</span><br></pre></td></tr></table></figure>

<h4 id="参数和变量"><a href="#参数和变量" class="headerlink" title="参数和变量"></a>参数和变量</h4><p>IN 传出参数<br>OUT 指返回值<br>INOUT 传入传出参数</p>
<h3 id="建立智能存储过程"><a href="#建立智能存储过程" class="headerlink" title="建立智能存储过程"></a>建立智能存储过程</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- example</span></span><br><span class="line"><span class="comment">-- Name: ordertotal</span></span><br><span class="line"><span class="comment">-- Parameters: onumber = order number</span></span><br><span class="line"><span class="comment">--             taxable = 0 if not taxable, 1 if taxable</span></span><br><span class="line"><span class="comment">--             ototal = order total variable</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> ordertotal(</span><br><span class="line">   <span class="keyword">IN</span> onumber <span class="built_in">INT</span>,</span><br><span class="line">   <span class="keyword">IN</span> taxable <span class="built_in">BOOLEAN</span>,</span><br><span class="line">   <span class="keyword">OUT</span> ototal <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)</span><br><span class="line">) <span class="keyword">COMMENT</span> <span class="string">'Obtain order total, optionally adding tax'</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Declare variable for total</span></span><br><span class="line">   <span class="keyword">DECLARE</span> total <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>);</span><br><span class="line">   <span class="comment">-- Declare tax percentage</span></span><br><span class="line">   <span class="keyword">DECLARE</span> taxrate <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Get the order total</span></span><br><span class="line">   <span class="keyword">SELECT</span> <span class="keyword">Sum</span>(item_price*quantity)</span><br><span class="line">   <span class="keyword">FROM</span> orderitems</span><br><span class="line">   <span class="keyword">WHERE</span> order_num = onumber</span><br><span class="line">   <span class="keyword">INTO</span> total;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Is this taxable?</span></span><br><span class="line">   IF taxable THEN</span><br><span class="line">      <span class="comment">-- Yes, so add taxrate to the total</span></span><br><span class="line">      <span class="keyword">SELECT</span> total+(total/<span class="number">100</span>*taxrate) <span class="keyword">INTO</span> total;</span><br><span class="line">   <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- And finally, save to out variable</span></span><br><span class="line">   <span class="keyword">SELECT</span> total <span class="keyword">INTO</span> ototal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<h4 id="检查存储过程"><a href="#检查存储过程" class="headerlink" title="检查存储过程"></a>检查存储过程</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">-- 查看SQL语句</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span>  &lt;<span class="keyword">name</span>&gt;;</span><br><span class="line"><span class="comment">-- 李处所有存储过程，like过滤指定</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PROCEDURE</span> <span class="keyword">STATUS</span> <span class="keyword">like</span> <span class="string">'name'</span>;</span><br></pre></td></tr></table></figure>

<h3 id="第二十四章-使用游标coursor"><a href="#第二十四章-使用游标coursor" class="headerlink" title="第二十四章  使用游标coursor"></a>第二十四章  使用游标coursor</h3><p>检索出的数据进行前进或后退多行，主要用于交互式应用滚动数据；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建游标</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> processorders()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">   <span class="keyword">DECLARE</span> ordernumbers <span class="keyword">CURSOR</span> <span class="comment">--declare关键字</span></span><br><span class="line">   <span class="keyword">FOR</span></span><br><span class="line">   <span class="keyword">SELECT</span> ordernum <span class="keyword">FROM</span> orders;</span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 打开游标</span></span><br><span class="line">OPEN ordernumbers;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关闭游标</span></span><br><span class="line"><span class="comment">-- 隐含关闭，如果不明确关闭游标，则MySQL会在到达END语句时自动关闭</span></span><br><span class="line">CLOSE ordernumbers；</span><br></pre></td></tr></table></figure>

<h4 id="数据游标"><a href="#数据游标" class="headerlink" title="数据游标"></a>数据游标</h4><p>游标打开后可以使用FETCH语句访问每一行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> processorders()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Declare local variables</span></span><br><span class="line">   <span class="keyword">DECLARE</span> done <span class="built_in">BOOLEAN</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">DECLARE</span> o <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Declare the cursor</span></span><br><span class="line">   <span class="keyword">DECLARE</span> ordernumbers <span class="keyword">CURSOR</span></span><br><span class="line">   <span class="keyword">FOR</span></span><br><span class="line">   <span class="keyword">SELECT</span> order_num <span class="keyword">FROM</span> orders;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Declare continue handler</span></span><br><span class="line">   <span class="keyword">DECLARE</span> CONTINUE <span class="keyword">HANDLER</span> <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">'02000'</span> <span class="keyword">SET</span> done=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Open the cursor</span></span><br><span class="line">   OPEN ordernumbers;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- Loop through all rows</span></span><br><span class="line">   REPEAT</span><br><span class="line"></span><br><span class="line">      <span class="comment">-- Get order number</span></span><br><span class="line">      FETCH ordernumbers INTO o;</span><br><span class="line"></span><br><span class="line">   <span class="comment">-- End of loop</span></span><br><span class="line">   UNTIL done <span class="keyword">END</span> <span class="keyword">REPEAT</span>;</span><br><span class="line">    <span class="comment">-- Close the cursor</span></span><br><span class="line">   CLOSE ordernumbers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DECLARE 语句的次序 DECLARE 语句的发布存在特定的次序。用DECLARE 语句定义的局部变量必须在定义任意游标或句柄之前定义，而句柄必须在游标之后定义。不遵守此顺序将产生错误消息。</p>
</blockquote>
<blockquote>
<p>重复或循环？ 除这里使用的REPEAT 语句外，MySQL还支持循环语句，它可用来重复执行代码，直到使用LEAVE 语句手动退出为止。通常REPEAT 语句的语法使它更适合于对游标进行循环</p>
</blockquote>
<h3 id="第二十五章-触发器"><a href="#第二十五章-触发器" class="headerlink" title="第二十五章  触发器"></a>第二十五章  触发器</h3><ul>
<li>触发器在每个表中唯一</li>
<li>每张表最多六个触发器 insert、update和delete的前后</li>
<li>单已出发起不能与多个事件或多个表关联</li>
<li>触发器失败不执行SQL操作</li>
</ul>
<p>insert-new 触发器临时表<br>delete-old 触发器只读变量（删除订单前将订单数据存入archive_orders）<br>update-触发器的虚拟表old，访问之前的值（只读），new表为新的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建触发器</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> &lt;tigger <span class="keyword">name</span>&gt; <span class="keyword">after</span> <span class="keyword">insert</span> &lt;table_name&gt; <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> &lt;actions&gt; ;</span><br><span class="line"><span class="comment">-- 例子：每次插入显示文本</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> newproduct <span class="keyword">after</span> <span class="keyword">insert</span> products <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span> <span class="keyword">select</span> <span class="string">'Product added'</span> ;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除触发器,触发器无更新，只能删除重建</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> &lt;<span class="keyword">name</span>&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="第二十六章-事务"><a href="#第二十六章-事务" class="headerlink" title="第二十六章 事务"></a>第二十六章 事务</h3><ul>
<li>类似批处理机制，InnoDB支持,关键词commit 、rollback、transaction、savepoint</li>
<li>不能退回select,create,drop操作</li>
<li>一般的SQL语句是隐含commit,事务需要明确提交</li>
<li>部分退回需要保留点（savepoint）</li>
<li>mysql链接可以设置是否自动提交更改<code>SET autocommit=0;</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">start</span> <span class="keyword">transaction</span></span><br><span class="line"></span><br><span class="line">// example:</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"><span class="keyword">ROLLBACK</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> ordertotals;</span><br><span class="line"></span><br><span class="line"><span class="keyword">savepoint</span> &lt;point-<span class="keyword">name</span>&gt;;</span><br><span class="line"><span class="keyword">rollback</span> <span class="keyword">to</span> &lt;point-<span class="keyword">name</span>&gt;;</span><br></pre></td></tr></table></figure>

<h3 id="第二十七章-全球化和本地化"><a href="#第二十七章-全球化和本地化" class="headerlink" title="第二十七章 全球化和本地化"></a>第二十七章 全球化和本地化</h3><blockquote>
<p>校对为不同语言字符串的排序顺序</p>
</blockquote>
<ul>
<li>字符集、编码、校对</li>
<li>字符集区分大小写由_cs表示</li>
<li>不区分大小写由_ci表示</li>
<li>如未指定校对，则使用字符集默认的校对,如<code>SHOW CHARACTER SET</code>显示</li>
<li></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看字符集</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span>;</span><br><span class="line"><span class="comment">-- 查看可用校对列表以及字符集</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">COLLATION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 系统字符集和校对</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'character%'</span>;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'collation%'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建表制定字符集</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line">(</span><br><span class="line">   columnn1   <span class="built_in">INT</span>,</span><br><span class="line">   columnn2   <span class="built_in">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">) <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> hebrew</span><br><span class="line">  <span class="keyword">COLLATE</span> hebrew_general_ci;</span><br><span class="line">  </span><br><span class="line"><span class="comment">-- 设置字段字符集</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mytable</span><br><span class="line">(</span><br><span class="line">   columnn1   <span class="built_in">INT</span>,</span><br><span class="line">   columnn2   <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">   column3    <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_general_ci <span class="keyword">SET</span> latin1 <span class="keyword">COLLATE</span> latin1_general_ci</span><br><span class="line">) <span class="keyword">DEFAULT</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> hebrew</span><br><span class="line">  <span class="keyword">COLLATE</span> hebrew_general_ci;</span><br><span class="line">  </span><br><span class="line"> <span class="comment">-- 设置select语句字符集，对排序起作用</span></span><br><span class="line"> </span><br><span class="line"> <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> customers</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> lastname, firstname <span class="keyword">COLLATE</span> latin1_general_cs;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>SELECT 的其他COLLATE 子句 除了这里看到的在ORDER BY 子句中使用以外，COLLATE 还可以用于GROUP BY 、HAVING 、聚集函数、别名等。<br>最后，值得注意的是，如果绝对需要，串可以在字符集之间进行转换。为此，使用Cast() 或Convert() 函数。</p>
</blockquote>
<h3 id="第二十八章-安全管理"><a href="#第二十八章-安全管理" class="headerlink" title="第二十八章 安全管理"></a>第二十八章 安全管理</h3><p>创建用户：</p>
<ul>
<li>关键词：create user,grant,insert grant;<br>,直接插入user表；</li>
<li>用户定义为user@Host,如无主机名默认为”%”;</li>
</ul>
<p>权限</p>
<ul>
<li>REVOKE 降权（撤销的权限必须存在，否则报错）</li>
<li>grant 加权</li>
<li>访问控制：</li>
</ul>
<ol>
<li>整个服务器，grant all 和 revoke all;</li>
<li>整个数据库 on database.*,</li>
<li>特定的标表，on datebase.table;</li>
<li>特定的列；</li>
<li>特定的存储过程；</li>
</ol>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建用户 IDENTIFIED BY明文转加密</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> ben <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'p@$$w0rd'</span>;</span><br><span class="line"><span class="comment">-- 改名</span></span><br><span class="line"><span class="keyword">rename</span> <span class="keyword">user</span> &lt;username&gt; <span class="keyword">to</span> &lt;<span class="keyword">new</span>-username&gt;;</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> &lt;username&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 展示用户权限</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GRANTS</span> <span class="keyword">FOR</span> &lt;username&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 加权限</span></span><br><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> &lt;tablename&gt;.* <span class="keyword">TO</span> &lt;<span class="keyword">user</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 修改密码,不指定用户为修改自己</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> &lt;<span class="keyword">user</span>&gt; = <span class="keyword">Password</span>(<span class="string">'&lt;new-pass&gt;'</span>);</span><br><span class="line"></span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### 第二十九章 数据库维护</span></span><br><span class="line"></span><br><span class="line">备份方式</span><br><span class="line"></span><br><span class="line">- mysqldump</span><br><span class="line">- mysqlhotcopy(并非所有引擎都支持)</span><br><span class="line">- <span class="keyword">backup</span> <span class="keyword">table</span> / <span class="keyword">select</span> <span class="keyword">into</span> <span class="keyword">outfile</span> 可以使用<span class="keyword">restore</span> tabel复原</span><br><span class="line"></span><br><span class="line">&gt;首先刷新未写数据 为了保证所有数据被写到磁盘（包括索引数据），可能需要在进行备份前使用<span class="keyword">FLUSH</span> <span class="keyword">TABLES</span> 语句。</span><br><span class="line"></span><br><span class="line"><span class="string">``</span><span class="string">`SQL</span></span><br><span class="line"><span class="string">-- 检查表键是否正确</span></span><br><span class="line"><span class="string">analyze tabel &lt;table&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-- CHECK TABLE 用来针对许多问题对表进行检查。在MyISAM 表上还对索引进行检查。CHECK TABLE 支持一系列的用于MyISAM 表的方式。CHANGED 检查自最后一次检查以来改动过的表。EXTENDED 执行最彻底的检查，FAST 只检查未正常关闭的表，MEDIUM 检查所有被删除的链接并进行键检验，QUICK 只进行快速扫描。如下所示，CHECK TABLE 发现和修复问题：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">CHECK TABLE orders, orderitems;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> -- 修复表</span></span><br><span class="line"><span class="string"> repair table</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string"> -- 从一个表删除大量数据</span></span><br><span class="line"><span class="string"> optimize table</span></span><br></pre></td></tr></table></figure>
<h4 id="诊断启动问题"><a href="#诊断启动问题" class="headerlink" title="诊断启动问题"></a>诊断启动问题</h4><p>–help 显示帮助——一个选项列表；<br>–safe-mode 装载减去某些最佳配置的服务器；<br>–verbose 显示全文本消息（为获得更详细的帮助消息与–help 联合使用）；<br>日志文件</p>
<h4 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h4><ul>
<li>错误日志。它包含启动和关闭问题以及任意关键错误的细节。此日志通常名为hostname.err ，位于data 目录中。此日志名可用–log-error 命令行选项更改。</li>
<li>查询日志。它记录所有MySQL活动，在诊断问题时非常有用。此日志文件可能会很快地变得非常大，因此不应该长期使用它。此日志通常名为hostname.log ，位于data 目录中。此名字可以用–log 命令行选项更改。</li>
<li>二进制日志。它记录更新过数据（或者可能更新过数据）的所有语句。此日志通常名为hostname-bin ，位于data 目录内。此名字可以用–log-bin 命令行选项更改。注意，这个日志文件是MySQL 5中添加的，以前的MySQL版本中使用的是更新日志。</li>
<li>缓慢查询日志。顾名思义，此日志记录执行缓慢的任何查询。这个日志在确定数据库何处需要优化很有用。此日志通常名为hostname-slow.log ，位于data 目录中。此名字可以用–log-slow-queries 命令行选项更改。</li>
</ul>
<p>在使用日志时，可用FLUSH LOGS 语句来刷新和重新开始所有日志文件。</p>
<h3 id="第三十章-改善性能"><a href="#第三十章-改善性能" class="headerlink" title="第三十章 改善性能"></a>第三十章 改善性能</h3><ol>
<li>存储过程比一条一条执行的快；</li>
<li>有的操作（包括INSERT ）支持一个可选的DELAYED 关键字，如果使用它，将把控制立即返回给调用程序，并且一旦有可能就实际执行该操作</li>
<li>在导入数据时，应该关闭自动提交。你可能还想删除索引（包括FULLTEXT 索引），然后在导入完成后再重建它们。</li>
<li>必须索引数据库表以改善数据检索的性能。确定索引什么不是一件微不足道的任务，需要分析使用的SELECT 语句以找出重复的WHERE 和ORDER BY 子句。如果一个简单的WHERE 子句返回结果所花的时间太长，则可以断定其中使用的列（或几个列）就是需要索引的对象。</li>
<li>索引改善数据检索的性能，但损害数据插入、删除和更新的性能。如果你有一些表，它们收集数据且不经常被搜索，则在有必要之前不要索引它们。（索引可根据需要添加和删除。）</li>
<li>LIKE 很慢。一般来说，最好是使用FULLTEXT 而不是LIKE 。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前设置</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">STATUS</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 显示所有活动进程，kill命令终结</span></span><br><span class="line"><span class="keyword">show</span> process <span class="keyword">list</span>;</span><br></pre></td></tr></table></figure>

<h3 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line"><span class="keyword">update</span> </span><br><span class="line"><span class="keyword">delete</span> </span><br><span class="line"><span class="keyword">insert</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">limit</span></span><br><span class="line"><span class="keyword">having</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="comment">-- with rollup每个分组及每个分组及别的值，聚合函数必须使用</span></span><br><span class="line"><span class="keyword">distinct</span> <span class="comment">--去重</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"></span><br><span class="line"><span class="literal">null</span></span><br><span class="line"><span class="keyword">is</span> <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">or</span></span><br><span class="line"><span class="keyword">between</span> <span class="keyword">and</span></span><br><span class="line"><span class="keyword">in</span></span><br><span class="line"><span class="keyword">and</span></span><br><span class="line"><span class="keyword">not</span></span><br><span class="line"><span class="keyword">like</span> <span class="comment">-- %多个字符 _单个字符 通配符搜索花费时间长</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">concat</span> <span class="comment">-- 拼接字段</span></span><br><span class="line"><span class="keyword">explain</span> <span class="comment">-- 分析SQL语句</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">count</span> <span class="comment">-- *包含空值 column 有值统计</span></span><br></pre></td></tr></table></figure>

<h3 id="function"><a href="#function" class="headerlink" title="function"></a>function</h3><p>rtrim<br>ltrim<br>trim<br>upper<br>now</p>
<h3 id="sqls"><a href="#sqls" class="headerlink" title="sqls"></a>sqls</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">trim</span>(<span class="string">'abc '</span>);</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">now</span>();</span><br><span class="line"><span class="comment">-- 不需要考虑闰年比对时间</span></span><br><span class="line"><span class="keyword">select</span> &lt;<span class="keyword">column</span>&gt; <span class="keyword">from</span> &lt;<span class="keyword">table</span>&gt; <span class="keyword">where</span> <span class="keyword">year</span>(<span class="built_in">date</span>) = <span class="number">2005</span> <span class="keyword">and</span> <span class="keyword">month</span>(<span class="built_in">date</span>) = <span class="number">9</span>;</span><br></pre></td></tr></table></figure>
<h3 id="others"><a href="#others" class="headerlink" title="others"></a>others</h3><h4 id="where-和having的区别"><a href="#where-和having的区别" class="headerlink" title="where 和having的区别"></a>where 和having的区别</h4><ol>
<li>前者过滤行，后者过滤分组</li>
<li>前者分组前过滤，后者分组后过滤</li>
</ol>
<blockquote>
<p>select子查询顺序为由内至外；</p>
</blockquote>
<h3 id="语句样例"><a href="#语句样例" class="headerlink" title="语句样例"></a>语句样例</h3><p>1、 更新字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tablename</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">ADD</span>     <span class="keyword">column</span>          datatype  [<span class="literal">NULL</span>|<span class="keyword">NOT</span> <span class="literal">NULL</span>]  [<span class="keyword">CONSTRAINTS</span>],</span><br><span class="line">    <span class="keyword">CHANGE</span>  <span class="keyword">column</span> <span class="keyword">columns</span>  datatype  [<span class="literal">NULL</span>|<span class="keyword">NOT</span> <span class="literal">NULL</span>]  [<span class="keyword">CONSTRAINTS</span>],</span><br><span class="line">    <span class="keyword">DROP</span>    <span class="keyword">column</span>,</span><br><span class="line">    ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>2、索引</p>
<figure class="highlight plain"><figcaption><span>INDEX indexname</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ON tablename (column [ASC|DESC], ...);</span><br></pre></td></tr></table></figure>

<p>3、 存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> procedurename( [<span class="keyword">parameters</span>] )</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">...</span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>

<p>4、 创建表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tablename</span><br><span class="line">(</span><br><span class="line">       <span class="keyword">column</span>    datatype    [<span class="literal">NULL</span>|<span class="keyword">NOT</span> <span class="literal">NULL</span>]    [<span class="keyword">CONSTRAINTS</span>],</span><br><span class="line">       <span class="keyword">column</span>    datatype    [<span class="literal">NULL</span>|<span class="keyword">NOT</span> <span class="literal">NULL</span>]    [<span class="keyword">CONSTRAINTS</span>],</span><br><span class="line">       ...</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>5、 添加用户</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> username[@hostname]</span><br><span class="line">[<span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> [<span class="keyword">PASSWORD</span>] <span class="string">'password'</span>];</span><br></pre></td></tr></table></figure>

<p>6、 添加视图</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> [<span class="keyword">OR</span> <span class="keyword">REPLACE</span>] <span class="keyword">VIEW</span> viewname</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br></pre></td></tr></table></figure>

<p>7、 删除表一行或多行</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> tablename</span><br><span class="line">[<span class="keyword">WHERE</span> ...];</span><br><span class="line">”</span><br></pre></td></tr></table></figure>

<p>8、 永久删除数据库对象，表 视图 索引等</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span>|<span class="keyword">INDEX</span>|<span class="keyword">PROCEDURE</span>|<span class="keyword">TABLE</span>|<span class="keyword">TRIGGER</span>|<span class="keyword">USER</span>|<span class="keyword">VIEW</span></span><br><span class="line">    itemname;</span><br></pre></td></tr></table></figure>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- insert</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span>|<span class="keyword">INDEX</span>|<span class="keyword">PROCEDURE</span>|<span class="keyword">TABLE</span>|<span class="keyword">TRIGGER</span>|<span class="keyword">USER</span>|<span class="keyword">VIEW</span></span><br><span class="line">    itemname;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- rollback</span></span><br><span class="line"><span class="keyword">ROLLBACK</span> [ <span class="keyword">TO</span> savepointname];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- savepoint</span></span><br><span class="line"><span class="keyword">SAVEPOINT</span> sp1;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- select</span></span><br><span class="line"><span class="keyword">SELECT</span> columnname, ...</span><br><span class="line"><span class="keyword">FROM</span> tablename, ...</span><br><span class="line">[<span class="keyword">WHERE</span> ...]</span><br><span class="line">[<span class="keyword">UNION</span> ...]</span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> ...]</span><br><span class="line">[<span class="keyword">HAVING</span> ...]</span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> ...];</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务</span></span><br><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- update</span></span><br><span class="line"><span class="keyword">UPDATE</span> tablename</span><br><span class="line"><span class="keyword">SET</span> columname = <span class="keyword">value</span>, ...</span><br><span class="line">[<span class="keyword">WHERE</span> ...];</span><br></pre></td></tr></table></figure>

<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3>





<h3 id="知识点记录"><a href="#知识点记录" class="headerlink" title="知识点记录"></a>知识点记录</h3><ul>
<li><input disabled="" type="checkbox"> MySQL数据类型</li>
<li><input disabled="" type="checkbox"> 系统表</li>
<li><input disabled="" type="checkbox"> 配置</li>
<li><input disabled="" type="checkbox"> 权限</li>
<li><input disabled="" type="checkbox"> 分库分表</li>
<li><input disabled="" type="checkbox"> 大数据</li>
<li><input disabled="" type="checkbox"> 主从同步</li>
<li><input disabled="" type="checkbox"> 前一复制</li>
<li><input disabled="" type="checkbox"> 读写分离</li>
<li><input disabled="" type="checkbox"> 索引</li>
<li><input disabled="" type="checkbox"> 优化</li>
<li><input disabled="" type="checkbox"> 全文搜索</li>
<li><input disabled="" type="checkbox"> 视图场景</li>
<li><input disabled="" type="checkbox"> 视图、存储过程区别</li>
<li><input disabled="" type="checkbox"> 函数</li>
</ul>

      </div>
      
      <footer class="post-footer">
        
        <nav class="post-nav"><a class="prev" href="/2020/06/29/Editor/VI%20/vim_del/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">VIM</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    <a class="next" href="/2020/06/29/Databases/NoSQL/">
        <span class="next-text nav-default">Databases/NoSQL</span>
        <span class="prev-text nav-mobile">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
    </nav></footer>
    </article></div><div class="comments" id="comments"></div></div>
      </main>

      <footer id="footer" class="footer"><div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even" target="_blank" rel="noopener">Even</a>
  </span>

  <span class="copyright-year">&copy;2020<span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Gloomy楠</span>
  </span>
</div>
</footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div><script type="text/javascript" src="/lib/jquery/jquery.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  <script type="text/javascript" src="/js/src/even.js?v="></script>
</body>
</html>
